import{u as L,a as m,b as Q,b5 as W,I as Y,aC as Z,r as D,aQ as H,aP as K,Y as X,E as ee,o as u,W as _,w as s,d as r,e as o,c as h,aZ as C,T as k,i as v,f as te,g as i}from"./index.1bb11c7d.js";import{E as oe,a as ae}from"./el-input.424f7e03.js";import{E as le,a as re}from"./el-form-item.18bec942.js";import{E as se}from"./el-progress.c46f28de.js";/* empty css                */import"./el-scrollbar.1f62721a.js";import{E as ne,a as de}from"./el-select.22c89663.js";import{A as w}from"./article.2a4161da.js";import{C as ie}from"./category.884915df.js";import{T as ue,E as ce}from"./index.esm.c27fbbc9.js";import"./index.08af8a2a.js";import"./index.8a409503.js";import"./scroll.292c786e.js";import"./validator.0d104d86.js";const pe=v("div",{class:"card-header"},[v("span",null,"\u7F16\u8F91\u6587\u7AE0")],-1),me=["src"],_e={style:{border:"1px solid #ccc"}},fe=te("\u4FDD\u5B58\u4FEE\u6539"),Fe={__name:"ListEdit",setup(ge){let U=L(),l=m({title:"",description:"",cate_1st:"",cate_2nd:"",main_photo:"",content:""}),x=Q(),E=m([]),p=m([]),f=async t=>{let{status:e,data:d}=await ie.subcate({id:t});if(e)return d};W(async()=>{try{E.value=await f(0);let{status:t,data:e}=await w.info({id:x.params.id});p.value=await f(e.cate_1st),t&&(l.value=e)}catch(t){console.log(t)}});let N=async t=>{p.value=await f(t),l.value.cate_2nd=p.value[0].id},B={Authorization:`Bearer ${sessionStorage.token}`},S={type:"avatar"};const R=t=>{if(/^image\/(jpeg|png|jpg)$/.test(t.type)){if(t.size/1024/1024>2)return i.error("\u5934\u50CF\u4F53\u79EF\u4E0D\u5141\u8BB8\u8D85\u8FC72MB!"),!1}else return i.error("\u5934\u50CF\u5FC5\u987B\u662FJPG/PNG/JPEG\u683C\u5F0F!"),!1;return!0},F=({status:t,msg:e,src:d},n)=>{t?(l.value.main_photo=d,i.success(e)):i.error(e)},P=(t,e)=>{let{status:d,msg:n}=JSON.parse(t.message);i.error(n)},g=Y(),I={},b={placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9...",MENU_CONF:{}};b.MENU_CONF.uploadImage={fieldName:"file",server:"http://localhost:3001/upload/editor/",headers:{Authorization:`Bearer ${sessionStorage.token}`}},Z(()=>{const t=g.value;t!=null&&t.destroy()});const O=t=>{g.value=t},y=m(),j=D({content:[{required:!0,message:"\u8BF7\u8F93\u5165\u5185\u5BB9\uFF01",trigger:"blur"}],title:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898!",trigger:"blur"},{min:1,max:50,message:"\u6807\u9898\u957F\u5EA6\u8981\u6C42\u57281-50\u4E4B\u95F4\uFF01",trigger:"blur"}],description:[{required:!0}],main_photo:[{required:!0}]});let q=t=>{t.validate(async(e,d)=>{if(e){const{status:n,msg:c}=await w.edit({...l.value});n?(i.success(c),U.push("/article/list")):i.error(c)}else console.log("\u6821\u9A8C\u5931\u8D25(\u5B57\u6BB5)",d),i.error("\u6821\u9A8C\u672A\u901A\u8FC7\uFF0C\u4FDD\u5B58\u4FEE\u6539\u5931\u8D25\uFF01")})};return(t,e)=>{const d=oe,n=le,c=ne,V=de,A=H,M=K("Plus"),T=X,$=se,z=ee,G=re,J=ae;return u(),_(J,null,{header:s(()=>[pe]),default:s(()=>[r(G,{ref_key:"formRef",ref:y,rules:j,model:o(l)},{default:s(()=>[r(n,{label:"\u6807\u9898",prop:"title"},{default:s(()=>[r(d,{modelValue:o(l).title,"onUpdate:modelValue":e[0]||(e[0]=a=>o(l).title=a)},null,8,["modelValue"])]),_:1}),r(n,{label:"\u63CF\u8FF0",prop:"description"},{default:s(()=>[r(d,{modelValue:o(l).description,"onUpdate:modelValue":e[1]||(e[1]=a=>o(l).description=a),rows:3,type:"textarea",placeholder:""},null,8,["modelValue"])]),_:1}),r(n,{label:"\u5206\u7C7B",prop:"classify"},{default:s(()=>[r(A,null,{default:s(()=>[r(V,{onChange:o(N),modelValue:o(l).cate_1st,"onUpdate:modelValue":e[2]||(e[2]=a=>o(l).cate_1st=a),class:"m-2",placeholder:"Select"},{default:s(()=>[(u(!0),h(k,null,C(o(E),a=>(u(),_(c,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["onChange","modelValue"]),r(V,{modelValue:o(l).cate_2nd,"onUpdate:modelValue":e[3]||(e[3]=a=>o(l).cate_2nd=a),class:"m-2",placeholder:"Select"},{default:s(()=>[(u(!0),h(k,null,C(o(p),a=>(u(),_(c,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),r(n,{label:"\u4E3B\u56FE",prop:"main_photo"},{default:s(()=>[r($,{class:"avatar-uploader",action:"http://localhost:3001/upload/common/",headers:o(B),data:o(S),"show-file-list":!1,accept:".png,.jpg,.jpeg","on-success":F,"on-error":P,"before-upload":R},{default:s(()=>[o(l).main_photo?(u(),h("img",{key:0,src:o(l).main_photo,class:"avatar"},null,8,me)):(u(),_(T,{key:1,class:"avatar-uploader-icon"},{default:s(()=>[r(M)]),_:1}))]),_:1},8,["headers","data"])]),_:1}),r(n,{label:"\u5185\u5BB9",prop:"content"},{default:s(()=>[v("div",_e,[r(o(ue),{style:{"border-bottom":"1px solid #ccc"},editor:o(g),defaultConfig:I},null,8,["editor"]),r(o(ce),{style:{height:"500px","overflow-y":"hidden"},modelValue:o(l).content,"onUpdate:modelValue":e[4]||(e[4]=a=>o(l).content=a),defaultConfig:b,onOnCreated:O},null,8,["modelValue"])])]),_:1}),r(n,null,{default:s(()=>[r(z,{type:"primary",onClick:e[5]||(e[5]=a=>o(q)(y.value))},{default:s(()=>[fe]),_:1})]),_:1})]),_:1},8,["rules","model"])]),_:1})}}};export{Fe as default};
