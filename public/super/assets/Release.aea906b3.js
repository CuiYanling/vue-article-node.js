import{u as G,ad as J,a as p,I as K,aC as L,N as Q,K as W,r as Y,aQ as Z,aP as D,Y as H,E as X,o as i,W as m,w as s,d as r,e,c as g,aZ as k,T as x,i as h,f as ee,g as u}from"./index.1bb11c7d.js";import{E as te,a as oe}from"./el-input.424f7e03.js";import{E as ae,a as le}from"./el-form-item.18bec942.js";import{E as re}from"./el-progress.c46f28de.js";/* empty css                */import"./el-scrollbar.1f62721a.js";import{E as se,a as ne}from"./el-select.22c89663.js";import{A as de}from"./article.2a4161da.js";import{C as ue}from"./category.884915df.js";import{T as ie,E as ce}from"./index.esm.c27fbbc9.js";import"./index.08af8a2a.js";import"./index.8a409503.js";import"./scroll.292c786e.js";import"./validator.0d104d86.js";const pe=h("div",{class:"card-header"},[h("span",null,"\u53D1\u5E03\u6587\u7AE0")],-1),me=["src"],_e={style:{border:"1px solid #ccc"}},fe=ee("\u53D1\u5E03\u6587\u7AE0"),Fe={__name:"Release",setup(ge){let U=G(),v=J("host"),o=p({title:"",description:"",cate_1st:"",cate_2nd:"",main_photo:"",content:""}),N={Authorization:`Bearer ${sessionStorage.token}`},w={type:"avatar"};const B=a=>{if(/^image\/(jpeg|png|jpg)$/.test(a.type)){if(a.size/1024/1024>2)return u.error("\u5934\u50CF\u4F53\u79EF\u4E0D\u5141\u8BB8\u8D85\u8FC72MB!"),!1}else return u.error("\u5934\u50CF\u5FC5\u987B\u662FJPG/PNG/JPEG\u683C\u5F0F!"),!1;return!0},S=({status:a,msg:t,src:d},n)=>{a?(o.value.main_photo=d,u.success(t)):u.error(t)},R=(a,t)=>{let{status:d,msg:n}=JSON.parse(a.message);u.error(n)},_=K(),F={},b={placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9...",MENU_CONF:{}};b.MENU_CONF.uploadImage={fieldName:"file",server:`${v}/upload/editor/`,headers:{Authorization:`Bearer ${sessionStorage.token}`}},L(()=>{const a=_.value;a!=null&&a.destroy()});const P=a=>{_.value=a};let E=p([]),f=p([]),V=async a=>{let{status:t,data:d}=await ue.subcate({id:a});if(t)return d};Q(async()=>{E.value=await V(0)}),W(()=>o.value.cate_1st,async(a,t)=>{f.value=await V(a),o.value.cate_2nd=f.value[0].id});const y=p(),$=Y({content:[{required:!0,message:"\u8BF7\u8F93\u5165\u5185\u5BB9\uFF01",trigger:"blur"}],title:[{required:!0,message:"\u8BF7\u8F93\u5165\u6807\u9898!",trigger:"blur"},{min:1,max:50,message:"\u6807\u9898\u957F\u5EA6\u8981\u6C42\u57281-50\u4E4B\u95F4\uFF01",trigger:"blur"}],description:[{required:!0,message:"\u8BF7\u8F93\u5165\u63CF\u8FF0!"},{min:1,max:500,message:"\u6807\u9898\u957F\u5EA6\u8981\u6C42\u57281-500\u4E4B\u95F4\uFF01",trigger:"blur"}],textarea:[{required:!0}],main_photo:[{required:!0}]});let j=a=>{a.validate(async(t,d)=>{if(t){const{status:n,msg:c}=await de.release({...o.value});n?(u.success(c),U.push("/article/list")):u.error(c)}else console.log("\u6821\u9A8C\u5931\u8D25(\u5B57\u6BB5)",d),u.error("\u6821\u9A8C\u672A\u901A\u8FC7\uFF0C\u53D1\u5E03\u516C\u544A\u5931\u8D25\uFF01")})};return(a,t)=>{const d=te,n=ae,c=se,C=ne,q=Z,I=D("Plus"),M=H,O=re,A=X,T=le,z=oe;return i(),m(z,null,{header:s(()=>[pe]),default:s(()=>[r(T,{ref_key:"formRef",ref:y,rules:$,model:e(o)},{default:s(()=>[r(n,{label:"\u6807\u9898",prop:"title"},{default:s(()=>[r(d,{modelValue:e(o).title,"onUpdate:modelValue":t[0]||(t[0]=l=>e(o).title=l)},null,8,["modelValue"])]),_:1}),r(n,{label:"\u63CF\u8FF0",prop:"description"},{default:s(()=>[r(d,{modelValue:e(o).description,"onUpdate:modelValue":t[1]||(t[1]=l=>e(o).description=l),rows:3,type:"textarea",placeholder:""},null,8,["modelValue"])]),_:1}),r(n,{label:"\u5206\u7C7B",model:e(o)},{default:s(()=>[r(q,null,{default:s(()=>[r(C,{modelValue:e(o).cate_1st,"onUpdate:modelValue":t[2]||(t[2]=l=>e(o).cate_1st=l),class:"m-2",placeholder:"Select"},{default:s(()=>[(i(!0),g(x,null,k(e(E),l=>(i(),m(c,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),r(C,{modelValue:e(o).cate_2nd,"onUpdate:modelValue":t[3]||(t[3]=l=>e(o).cate_2nd=l),class:"m-2",placeholder:"Select"},{default:s(()=>[(i(!0),g(x,null,k(e(f),l=>(i(),m(c,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"]),r(n,{label:"\u4E3B\u56FE",prop:"main_photo"},{default:s(()=>[r(O,{class:"avatar-uploader",action:`${e(v)}/upload/common/`,headers:e(N),data:e(w),"show-file-list":!1,accept:".png,.jpg,.jpeg","on-success":S,"on-error":R,"before-upload":B},{default:s(()=>[e(o).main_photo?(i(),g("img",{key:0,src:e(o).main_photo,class:"avatar"},null,8,me)):(i(),m(M,{key:1,class:"avatar-uploader-icon"},{default:s(()=>[r(I)]),_:1}))]),_:1},8,["action","headers","data"])]),_:1}),r(n,{label:"\u5185\u5BB9",prop:"content"},{default:s(()=>[h("div",_e,[r(e(ie),{style:{"border-bottom":"1px solid #ccc"},editor:e(_),defaultConfig:F},null,8,["editor"]),r(e(ce),{style:{height:"500px","overflow-y":"hidden"},modelValue:e(o).content,"onUpdate:modelValue":t[4]||(t[4]=l=>e(o).content=l),defaultConfig:b,onOnCreated:P},null,8,["modelValue"])])]),_:1}),r(n,null,{default:s(()=>[r(A,{type:"primary",onClick:t[5]||(t[5]=l=>e(j)(y.value))},{default:s(()=>[fe]),_:1})]),_:1})]),_:1},8,["rules","model"])]),_:1})}}};export{Fe as default};
