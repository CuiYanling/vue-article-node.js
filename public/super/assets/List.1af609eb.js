import{a as u,N as R,r as N,E as q,o as S,c as j,d as o,w as t,e as a,aM as C,T as A,i as _,a2 as G,a0 as x,f,g as w}from"./index.1bb11c7d.js";import{E as H}from"./el-dialog.ffa9934a.js";import"./el-overlay.1f7d1ab9.js";import{E as J,a as K}from"./el-form-item.18bec942.js";import{a as O,E as Q}from"./el-input.424f7e03.js";import{E as W}from"./el-tree.5fcf89d9.js";import"./el-checkbox.46989ebd.js";import{E as X}from"./el-message-box.01abd863.js";import{C as b}from"./category.884915df.js";import"./index.08af8a2a.js";import"./scroll.292c786e.js";import"./validator.0d104d86.js";const Y=_("div",{class:"card-header"},[_("span",null,"\u5206\u7C7B\u5217\u8868-\u52A0\u8F7D\u5168\u90E8\u5B50\u96C6-\u6811\u5F62data")],-1),Z={class:"custom-tree-node"},ee={class:"action"},le=f(" \u7F16\u8F91"),te=f("\u6DFB\u52A0"),ae=f(" \u5220\u9664"),oe={class:"dialog-footer"},se=f("\u53D6\u6D88"),ne=f("\u6DFB\u52A0"),ie={class:"dialog-footer"},re=f("\u53D6\u6D88"),de=f("\u786E\u8BA4"),be={__name:"List",setup(ue){let p=u([]);const U={label:"name"};R(async()=>{let{status:n,msg:e,data:s}=await b.list({type:"tree"});n&&(p.value=[{id:0,name:"\u5168\u90E8\u5206\u7C7B",children:s}])});let B=N({name:[{required:!0,message:"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u5206\u7C7B\u540D\u79F0\uFF01",trigger:"blur"}]}),c=u({}),V=u({}),i=u(!1),D=u(),y=N({name:""}),z=(n,e)=>{i.value=!0,c.value=e,V.value=n},F=n=>{n.validate(async e=>{if(e){let{status:s,msg:g,data:d}=await b.insert({...y,parent_id:c.value.id});if(s){console.log(d);const m={...d,...y,children:[]};c.value.children||(c.value.children=[]),c.value.children.push(m),p.value=[...p.value],i.value=!1}}})},r=u(!1),I=u(),v=u({name:""}),T=(n,e)=>{r.value=!0,v.value={...e},c.value=e,V.value=n},L=n=>{n.validate(async e=>{if(e){let{status:s,msg:g,data:d}=await b.edit({...v.value});s&&(V.value.data={...v.value},r.value=!1)}})},P=(n,e)=>{X.confirm("\u6B64\u64CD\u4F5C\u5C06\u6C38\u4E45\u5220\u9664\u8BE5\u5206\u7C7B\uFF0C\u786E\u5B9A\u5220\u9664\u561B\uFF1F",{type:"warning"}).then(async()=>{let{status:s,msg:g}=await b.remove({id:e.id});if(s){const d=n.parent,m=d.data.children||d.data,h=m.findIndex(k=>k.id===e.id);m.splice(h,1),p.value=[...p.value],w.success(g)}else w.error(g)}).catch(()=>{w.info("\u53D6\u6D88\u6210\u529F")})};return(n,e)=>{const s=q,g=W,d=O,m=Q,h=J,k=K,M=H;return S(),j(A,null,[o(d,{class:"box-card"},{header:t(()=>[Y]),default:t(()=>[o(g,{data:a(p),props:U,"default-expand-all":""},{default:t(({node:l,data:E})=>[_("span",Z,[_("span",null,G(l.label),1),_("div",ee,[o(s,{icon:"edit",onClick:x($=>a(T)(l,E),["stop"]),disabled:E.id===0,type:"primary",link:"",size:"small"},{default:t(()=>[le]),_:2},1032,["onClick","disabled"]),o(s,{icon:"CirclePlus",onClick:x($=>a(z)(l,E),["stop"]),type:"primary",link:"",size:"small"},{default:t(()=>[te]),_:2},1032,["onClick"]),o(s,{icon:"delete",onClick:x($=>a(P)(l,E),["stop"]),disabled:E.id===0,type:"primary",link:"",size:"small"},{default:t(()=>[ae]),_:2},1032,["onClick","disabled"])])])]),_:1},8,["data"])]),_:1}),o(M,{modelValue:a(i),"onUpdate:modelValue":e[3]||(e[3]=l=>C(i)?i.value=l:i=l),title:"\u6DFB\u52A0\u5206\u7C7B"},{footer:t(()=>[_("span",oe,[o(s,{onClick:e[1]||(e[1]=l=>C(i)?i.value=!1:i=!1)},{default:t(()=>[se]),_:1}),o(s,{type:"primary",onClick:e[2]||(e[2]=l=>a(F)(a(D)))},{default:t(()=>[ne]),_:1})])]),default:t(()=>[o(k,{ref_key:"insert_form_ref",ref:D,rules:a(B),model:a(y)},{default:t(()=>[o(h,{label:"\u5206\u7C7B\u540D\u79F0",prop:"name","status-icon":"","label-width":"80px"},{default:t(()=>[o(m,{modelValue:a(y).name,"onUpdate:modelValue":e[0]||(e[0]=l=>a(y).name=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue"]),o(M,{modelValue:a(r),"onUpdate:modelValue":e[7]||(e[7]=l=>C(r)?r.value=l:r=l),title:"\u7F16\u8F91\u5206\u7C7B"},{footer:t(()=>[_("span",ie,[o(s,{onClick:e[5]||(e[5]=l=>C(r)?r.value=!1:r=!1)},{default:t(()=>[re]),_:1}),o(s,{type:"primary",onClick:e[6]||(e[6]=l=>a(L)(a(I)))},{default:t(()=>[de]),_:1})])]),default:t(()=>[o(k,{ref_key:"edit_form_ref",ref:I,rules:a(B),model:a(v)},{default:t(()=>[o(h,{label:"\u5206\u7C7B\u540D\u79F0",prop:"name","status-icon":"","label-width":"80px"},{default:t(()=>[o(m,{modelValue:a(v).name,"onUpdate:modelValue":e[4]||(e[4]=l=>a(v).name=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])],64)}}};export{be as default};
