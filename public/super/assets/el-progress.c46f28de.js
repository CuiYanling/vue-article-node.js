import{n as q,s as h,y as W,H as I,j as R,bq as ye,br as re,$ as ge,bs as le,bo as ie,az as he,x as Q,o as y,c as S,U as m,e,i as O,a3 as j,V as T,a2 as K,S as $,W as _,w as U,X as be,Y as A,a4 as H,ab as ue,aB as Y,a8 as ke,v as Z,a1 as C,a as de,aZ as $e,bh as ce,d as B,bt as we,a0 as M,bu as Ee,bv as Se,T as Ce,bw as Pe,av as Re,ad as Te,I as J,bx as Ue,by as Fe,K as x,M as Le,B as _e,G as De,aC as Oe,ac as Be,P as Ne,bz as ee,Z as te}from"./index.1bb11c7d.js";import{u as je}from"./index.08af8a2a.js";const pe=Symbol("uploadContextKey"),Ae=q({type:{type:String,default:"line",values:["line","circle","dashboard"]},percentage:{type:Number,default:0,validator:o=>o>=0&&o<=100},status:{type:String,default:"",values:["","success","exception","warning"]},indeterminate:{type:Boolean,default:!1},duration:{type:Number,default:3},strokeWidth:{type:Number,default:6},strokeLinecap:{type:h(String),default:"round"},textInside:{type:Boolean,default:!1},width:{type:Number,default:126},showText:{type:Boolean,default:!0},color:{type:h([String,Array,Function]),default:""},format:{type:h(Function),default:o=>`${o}%`}}),Ie=["aria-valuenow"],Me={viewBox:"0 0 100 100"},qe=["d","stroke","stroke-width"],ze=["d","stroke","opacity","stroke-linecap","stroke-width"],We={key:0},He={name:"ElProgress"},Ke=W({...He,props:Ae,setup(o){const s=o,n={success:"#13ce66",exception:"#ff4949",warning:"#e6a23c",default:"#20a0ff"},a=I("progress"),d=R(()=>({width:`${s.percentage}%`,animationDuration:`${s.duration}s`,backgroundColor:E(s.percentage)})),p=R(()=>(s.strokeWidth/s.width*100).toFixed(1)),f=R(()=>["circle","dashboard"].includes(s.type)?Number.parseInt(`${50-Number.parseFloat(p.value)/2}`,10):0),P=R(()=>{const l=f.value,F=s.type==="dashboard";return`
          M 50 50
          m 0 ${F?"":"-"}${l}
          a ${l} ${l} 0 1 1 0 ${F?"-":""}${l*2}
          a ${l} ${l} 0 1 1 0 ${F?"":"-"}${l*2}
          `}),u=R(()=>2*Math.PI*f.value),b=R(()=>s.type==="dashboard"?.75:1),c=R(()=>`${-1*u.value*(1-b.value)/2}px`),w=R(()=>({strokeDasharray:`${u.value*b.value}px, ${u.value}px`,strokeDashoffset:c.value})),i=R(()=>({strokeDasharray:`${u.value*b.value*(s.percentage/100)}px, ${u.value}px`,strokeDashoffset:c.value,transition:"stroke-dasharray 0.6s ease 0s, stroke 0.6s ease, opacity ease 0.6s"})),t=R(()=>{let l;return s.color?l=E(s.percentage):l=n[s.status]||n.default,l}),r=R(()=>s.status==="warning"?ye:s.type==="line"?s.status==="success"?re:ge:s.status==="success"?le:ie),g=R(()=>s.type==="line"?12+s.strokeWidth*.4:s.width*.111111+2),k=R(()=>s.format(s.percentage));function v(l){const F=100/l.length;return l.map((D,N)=>Q(D)?{color:D,percentage:(N+1)*F}:D).sort((D,N)=>D.percentage-N.percentage)}const E=l=>{var F;const{color:L}=s;if(he(L))return L(l);if(Q(L))return L;{const D=v(L);for(const N of D)if(N.percentage>l)return N.color;return(F=D[D.length-1])==null?void 0:F.color}};return(l,F)=>(y(),S("div",{class:m([e(a).b(),e(a).m(l.type),e(a).is(l.status),{[e(a).m("without-text")]:!l.showText,[e(a).m("text-inside")]:l.textInside}]),role:"progressbar","aria-valuenow":l.percentage,"aria-valuemin":"0","aria-valuemax":"100"},[l.type==="line"?(y(),S("div",{key:0,class:m(e(a).b("bar"))},[O("div",{class:m(e(a).be("bar","outer")),style:j({height:`${l.strokeWidth}px`})},[O("div",{class:m([e(a).be("bar","inner"),{[e(a).bem("bar","inner","indeterminate")]:l.indeterminate}]),style:j(e(d))},[(l.showText||l.$slots.default)&&l.textInside?(y(),S("div",{key:0,class:m(e(a).be("bar","innerText"))},[T(l.$slots,"default",{percentage:l.percentage},()=>[O("span",null,K(e(k)),1)])],2)):$("v-if",!0)],6)],6)],2)):(y(),S("div",{key:1,class:m(e(a).b("circle")),style:j({height:`${l.width}px`,width:`${l.width}px`})},[(y(),S("svg",Me,[O("path",{class:m(e(a).be("circle","track")),d:e(P),stroke:`var(${e(a).cssVarName("fill-color-light")}, #e5e9f2)`,"stroke-width":e(p),fill:"none",style:j(e(w))},null,14,qe),O("path",{class:m(e(a).be("circle","path")),d:e(P),stroke:e(t),fill:"none",opacity:l.percentage?1:0,"stroke-linecap":l.strokeLinecap,"stroke-width":e(p),style:j(e(i))},null,14,ze)]))],6)),(l.showText||l.$slots.default)&&!l.textInside?(y(),S("div",{key:2,class:m(e(a).e("text")),style:j({fontSize:`${e(g)}px`})},[T(l.$slots,"default",{percentage:l.percentage},()=>[l.status?(y(),_(e(A),{key:1},{default:U(()=>[(y(),_(be(e(r))))]),_:1})):(y(),S("span",We,K(e(k)),1))])],6)):$("v-if",!0)],10,Ie))}});var Ve=H(Ke,[["__file","/home/runner/work/element-plus/element-plus/packages/components/progress/src/progress.vue"]]);const Xe=ue(Ve),Ge="ElUpload";class Ze extends Error{constructor(s,n,a,d){super(s),this.name="UploadAjaxError",this.status=n,this.method=a,this.url=d}}function se(o,s,n){let a;return n.response?a=`${n.response.error||n.response}`:n.responseText?a=`${n.responseText}`:a=`fail to ${s.method} ${o} ${n.status}`,new Ze(a,n.status,s.method,o)}function Je(o){const s=o.responseText||o.response;if(!s)return s;try{return JSON.parse(s)}catch{return s}}const Ye=o=>{typeof XMLHttpRequest>"u"&&Y(Ge,"XMLHttpRequest is undefined");const s=new XMLHttpRequest,n=o.action;s.upload&&s.upload.addEventListener("progress",p=>{const f=p;f.percent=p.total>0?p.loaded/p.total*100:0,o.onProgress(f)});const a=new FormData;if(o.data)for(const[p,f]of Object.entries(o.data))Array.isArray(f)?a.append(p,...f):a.append(p,f);a.append(o.filename,o.file,o.file.name),s.addEventListener("error",()=>{o.onError(se(n,o,s))}),s.addEventListener("load",()=>{if(s.status<200||s.status>=300)return o.onError(se(n,o,s));o.onSuccess(Je(s))}),s.open(o.method,n,!0),o.withCredentials&&"withCredentials"in s&&(s.withCredentials=!0);const d=o.headers||{};if(d instanceof Headers)d.forEach((p,f)=>s.setRequestHeader(f,p));else for(const[p,f]of Object.entries(d))ke(f)||s.setRequestHeader(p,String(f));return s.send(a),s},fe=["text","picture","picture-card"];let Qe=1;const ve=()=>Date.now()+Qe++,me=q({action:{type:String,default:"#"},headers:{type:h(Object)},method:{type:String,default:"post"},data:{type:Object,default:()=>Z({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},type:{type:String,default:"select"},fileList:{type:h(Array),default:()=>Z([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:fe,default:"text"},httpRequest:{type:h(Function),default:Ye},disabled:Boolean,limit:Number}),xe=q({...me,beforeUpload:{type:h(Function),default:C},beforeRemove:{type:h(Function)},onRemove:{type:h(Function),default:C},onChange:{type:h(Function),default:C},onPreview:{type:h(Function),default:C},onSuccess:{type:h(Function),default:C},onProgress:{type:h(Function),default:C},onError:{type:h(Function),default:C},onExceed:{type:h(Function),default:C}}),et=q({files:{type:h(Array),default:()=>Z([])},disabled:{type:Boolean,default:!1},handlePreview:{type:h(Function),default:C},listType:{type:String,values:fe,default:"text"}}),tt={remove:o=>!!o},st=["onKeydown"],at=["src"],ot=["onClick"],nt=["onClick"],rt=["onClick"],lt={name:"ElUploadList"},it=W({...lt,props:et,emits:tt,setup(o,{emit:s}){const{t:n}=je(),a=I("upload"),d=I("icon"),p=I("list"),f=de(!1),P=u=>{s("remove",u)};return(u,b)=>(y(),_(Pe,{tag:"ul",class:m([e(a).b("list"),e(a).bm("list",u.listType),e(a).is("disabled",u.disabled)]),name:e(p).b()},{default:U(()=>[(y(!0),S(Ce,null,$e(u.files,c=>(y(),S("li",{key:c.uid||c.name,class:m([e(a).be("list","item"),e(a).is(c.status),{focusing:f.value}]),tabindex:"0",onKeydown:ce(w=>!u.disabled&&P(c),["delete"]),onFocus:b[0]||(b[0]=w=>f.value=!0),onBlur:b[1]||(b[1]=w=>f.value=!1),onClick:b[2]||(b[2]=w=>f.value=!1)},[T(u.$slots,"default",{file:c},()=>[u.listType==="picture"||c.status!=="uploading"&&u.listType==="picture-card"?(y(),S("img",{key:0,class:m(e(a).be("list","item-thumbnail")),src:c.url,alt:""},null,10,at)):$("v-if",!0),c.status==="uploading"||u.listType!=="picture-card"?(y(),S("div",{key:1,class:m(e(a).be("list","item-info"))},[O("a",{class:m(e(a).be("list","item-name")),onClick:M(w=>u.handlePreview(c),["prevent"])},[B(e(A),{class:m(e(d).m("document"))},{default:U(()=>[B(e(we))]),_:1},8,["class"]),O("span",{class:m(e(a).be("list","item-file-name"))},K(c.name),3)],10,ot),c.status==="uploading"?(y(),_(e(Xe),{key:0,type:u.listType==="picture-card"?"circle":"line","stroke-width":u.listType==="picture-card"?6:2,percentage:Number(c.percentage),style:j(u.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):$("v-if",!0)],2)):$("v-if",!0),O("label",{class:m(e(a).be("list","item-status-label"))},[u.listType==="text"?(y(),_(e(A),{key:0,class:m([e(d).m("upload-success"),e(d).m("circle-check")])},{default:U(()=>[B(e(re))]),_:1},8,["class"])):["picture-card","picture"].includes(u.listType)?(y(),_(e(A),{key:1,class:m([e(d).m("upload-success"),e(d).m("check")])},{default:U(()=>[B(e(le))]),_:1},8,["class"])):$("v-if",!0)],2),u.disabled?$("v-if",!0):(y(),_(e(A),{key:2,class:m(e(d).m("close")),onClick:w=>P(c)},{default:U(()=>[B(e(ie))]),_:2},1032,["class","onClick"])),$(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),$(" This is a bug which needs to be fixed "),$(" TODO: Fix the incorrect navigation interaction "),u.disabled?$("v-if",!0):(y(),S("i",{key:3,class:m(e(d).m("close-tip"))},K(e(n)("el.upload.deleteTip")),3)),u.listType==="picture-card"?(y(),S("span",{key:4,class:m(e(a).be("list","item-actions"))},[O("span",{class:m(e(a).be("list","item-preview")),onClick:w=>u.handlePreview(c)},[B(e(A),{class:m(e(d).m("zoom-in"))},{default:U(()=>[B(e(Ee))]),_:1},8,["class"])],10,nt),u.disabled?$("v-if",!0):(y(),S("span",{key:0,class:m(e(a).be("list","item-delete")),onClick:w=>P(c)},[B(e(A),{class:m(e(d).m("delete"))},{default:U(()=>[B(e(Se))]),_:1},8,["class"])],10,rt))],2)):$("v-if",!0)])],42,st))),128)),T(u.$slots,"append")]),_:3},8,["class","name"]))}});var ae=H(it,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const ut=q({disabled:{type:Boolean,default:!1}}),dt={file:o=>Re(o)},ct=["onDrop","onDragover"],pt={name:"ElUploadDrag"},ft=W({...pt,props:ut,emits:dt,setup(o,{emit:s}){const n=o,a="ElUploadDrag",d=Te(pe);d||Y(a,"usage: <el-upload><el-upload-dragger /></el-upload>");const p=I("upload"),f=de(!1),P=b=>{if(n.disabled)return;f.value=!1;const c=Array.from(b.dataTransfer.files),w=d.accept.value;if(!w){s("file",c);return}const i=c.filter(t=>{const{type:r,name:g}=t,k=g.includes(".")?`.${g.split(".").pop()}`:"",v=r.replace(/\/.*$/,"");return w.split(",").map(E=>E.trim()).filter(E=>E).some(E=>E.startsWith(".")?k===E:/\/\*$/.test(E)?v===E.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(E)?r===E:!1)});s("file",i)},u=()=>{n.disabled||(f.value=!0)};return(b,c)=>(y(),S("div",{class:m([e(p).b("dragger"),e(p).is("dragover",f.value)]),onDrop:M(P,["prevent"]),onDragover:M(u,["prevent"]),onDragleave:c[0]||(c[0]=M(w=>f.value=!1,["prevent"]))},[T(b.$slots,"default")],42,ct))}});var vt=H(ft,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const mt=q({...me,beforeUpload:{type:h(Function),default:C},onRemove:{type:h(Function),default:C},onStart:{type:h(Function),default:C},onSuccess:{type:h(Function),default:C},onProgress:{type:h(Function),default:C},onError:{type:h(Function),default:C},onExceed:{type:h(Function),default:C}}),yt=["onKeydown"],gt=["name","multiple","accept"],ht={name:"ElUploadContent",inheritAttrs:!1},bt=W({...ht,props:mt,setup(o,{expose:s}){const n=o,a=I("upload"),d=J({}),p=J(),f=t=>{if(t.length===0)return;const{autoUpload:r,limit:g,fileList:k,multiple:v,onStart:E,onExceed:l}=n;if(g&&k.length+t.length>g){l(t,k);return}v||(t=t.slice(0,1));for(const F of t){const L=F;L.uid=ve(),E(L),r&&P(L)}},P=async t=>{if(p.value.value="",!n.beforeUpload)return u(t);let r;try{r=await n.beforeUpload(t)}catch{r=!1}if(r===!1){n.onRemove(t);return}let g=t;r instanceof Blob&&(r instanceof File?g=r:g=new File([r],t.name,{type:t.type})),u(Object.assign(g,{uid:t.uid}))},u=t=>{const{headers:r,data:g,method:k,withCredentials:v,name:E,action:l,onProgress:F,onSuccess:L,onError:D,httpRequest:N}=n,{uid:V}=t,X={headers:r||{},withCredentials:v,file:t,data:g,method:k,filename:E,action:l,onProgress:z=>{F(z,t)},onSuccess:z=>{L(z,t),delete d.value[V]},onError:z=>{D(z,t),delete d.value[V]}},G=N(X);d.value[V]=G,G instanceof Promise&&G.then(X.onSuccess,X.onError)},b=t=>{const r=t.target.files;!r||f(Array.from(r))},c=()=>{n.disabled||(p.value.value="",p.value.click())},w=()=>{c()};return s({abort:t=>{Ue(d.value).filter(t?([g])=>String(t.uid)===g:()=>!0).forEach(([g,k])=>{k instanceof XMLHttpRequest&&k.abort(),delete d.value[g]})},upload:P}),(t,r)=>(y(),S("div",{class:m([e(a).b(),e(a).m(t.listType),e(a).is("drag",t.drag)]),tabindex:"0",onClick:c,onKeydown:ce(M(w,["self"]),["enter","space"])},[t.drag?(y(),_(vt,{key:0,disabled:t.disabled,onFile:f},{default:U(()=>[T(t.$slots,"default")]),_:3},8,["disabled"])):T(t.$slots,"default",{key:1}),O("input",{ref_key:"inputRef",ref:p,class:m(e(a).e("input")),name:t.name,multiple:t.multiple,accept:t.accept,type:"file",onChange:b,onClick:r[0]||(r[0]=M(()=>{},["stop"]))},null,42,gt)],42,yt))}});var oe=H(bt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const ne="ElUpload",kt=o=>{var s;(s=o.url)!=null&&s.startsWith("blob:")&&URL.revokeObjectURL(o.url)},$t=(o,s)=>{const n=Fe(o,"fileList",void 0,{passive:!0}),a=i=>n.value.find(t=>t.uid===i.uid);function d(i){var t;(t=s.value)==null||t.abort(i)}function p(i=["ready","uploading","success","fail"]){n.value=n.value.filter(t=>!i.includes(t.status))}const f=(i,t)=>{const r=a(t);!r||(console.error(i),r.status="fail",n.value.splice(n.value.indexOf(r),1),o.onError(i,r,n.value),o.onChange(r,n.value))},P=(i,t)=>{const r=a(t);!r||(o.onProgress(i,r,n.value),r.status="uploading",r.percentage=Math.round(i.percent))},u=(i,t)=>{const r=a(t);!r||(r.status="success",r.response=i,o.onSuccess(i,r,n.value),o.onChange(r,n.value))},b=i=>{const t={name:i.name,percentage:0,status:"ready",size:i.size,raw:i,uid:i.uid};if(o.listType==="picture-card"||o.listType==="picture")try{t.url=URL.createObjectURL(i)}catch(r){Le(ne,r.message),o.onError(r,t,n.value)}n.value=[...n.value,t],o.onChange(t,n.value)},c=async i=>{const t=i instanceof File?a(i):i;t||Y(ne,"file to be removed not found");const r=g=>{d(g);const k=n.value;k.splice(k.indexOf(g),1),o.onRemove(g,k),kt(g)};o.beforeRemove?await o.beforeRemove(t,n.value)!==!1&&r(t):r(t)};function w(){n.value.filter(({status:i})=>i==="ready").forEach(({raw:i})=>{var t;return i&&((t=s.value)==null?void 0:t.upload(i))})}return x(()=>o.listType,i=>{i!=="picture-card"&&i!=="picture"||(n.value=n.value.map(t=>{const{raw:r,url:g}=t;if(!g&&r)try{t.url=URL.createObjectURL(r)}catch(k){o.onError(k,t,n.value)}return t}))}),x(n,i=>{for(const t of i)t.uid||(t.uid=ve()),t.status||(t.status="success")},{immediate:!0,deep:!0}),{uploadFiles:n,abort:d,clearFiles:p,handleError:f,handleProgress:P,handleStart:b,handleSuccess:u,handleRemove:c,submit:w}},wt={name:"ElUpload"},Et=W({...wt,props:xe,setup(o,{expose:s}){const n=o,a=_e(),d=De(),p=J(),{abort:f,submit:P,clearFiles:u,uploadFiles:b,handleStart:c,handleError:w,handleRemove:i,handleSuccess:t,handleProgress:r}=$t(n,p),g=R(()=>n.listType==="picture-card"),k=R(()=>({...n,fileList:b.value,onStart:c,onProgress:r,onSuccess:t,onError:w,onRemove:i}));return Oe(()=>{b.value.forEach(({url:v})=>{v!=null&&v.startsWith("blob:")&&URL.revokeObjectURL(v)})}),Be(pe,{accept:Ne(n,"accept")}),s({abort:f,submit:P,clearFiles:u,handleStart:c,handleRemove:i}),(v,E)=>(y(),S("div",null,[e(g)&&v.showFileList?(y(),_(ae,{key:0,disabled:e(d),"list-type":v.listType,files:e(b),"handle-preview":v.onPreview,onRemove:e(i)},ee({append:U(()=>[v.listType==="picture-card"?(y(),_(oe,te({key:0,ref_key:"uploadRef",ref:p},e(k)),{default:U(()=>[e(a).trigger?T(v.$slots,"trigger",{key:0}):$("v-if",!0),!e(a).trigger&&e(a).default?T(v.$slots,"default",{key:1}):$("v-if",!0)]),_:3},16)):$("v-if",!0)]),_:2},[v.$slots.file?{name:"default",fn:U(({file:l})=>[T(v.$slots,"file",{file:l})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):$("v-if",!0),v.listType!=="picture-card"?(y(),_(oe,te({key:1,ref_key:"uploadRef",ref:p},e(k)),{default:U(()=>[e(a).trigger?T(v.$slots,"trigger",{key:0}):$("v-if",!0),!e(a).trigger&&e(a).default?T(v.$slots,"default",{key:1}):$("v-if",!0)]),_:3},16)):$("v-if",!0),v.$slots.trigger?T(v.$slots,"default",{key:2}):$("v-if",!0),T(v.$slots,"tip"),!e(g)&&v.showFileList?(y(),_(ae,{key:3,disabled:e(d),"list-type":v.listType,files:e(b),"handle-preview":v.onPreview,onRemove:e(i)},ee({_:2},[v.$slots.file?{name:"default",fn:U(({file:l})=>[T(v.$slots,"file",{file:l})])}:void 0]),1032,["disabled","list-type","files","handle-preview","onRemove"])):$("v-if",!0)]))}});var St=H(Et,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const Rt=ue(St);export{Rt as E};
